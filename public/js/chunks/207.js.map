{"version":3,"sources":["webpack:///resources/js/src/views/pages/carriers/components/FilesTab.vue","webpack:///./resources/js/src/views/pages/carriers/components/FilesTab.vue","webpack:///./resources/js/src/views/pages/carriers/components/FilesTab.vue?97a0","webpack:///./resources/js/src/views/pages/carriers/components/FilesTab.vue?eb0a","webpack:///./resources/js/src/views/pages/carriers/components/FilesTab.vue?c8aa"],"names":["render","_vm","_c","_self","attrs","dataArray","files","showFileUploadIcon","imagePreview","isEditMode","showDownload","on","addFolder","deleteFile","uploadFiles","staticRenderFns","_withStripped"],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAeA;AACA;AAEA;AACA,kBADA;AAEA;AACA;AAAA;AAAA;AADA,GAFA;AAKA;AACA;AACA,kBADA;AAEA;AAAA;AAAA;AAFA,KADA;AAKA;AACA,mBADA;AAEA;AAFA;AALA,GALA;AAeA,8BACA,yFADA;AAGA,cAHA,wBAGA;AACA,+CACA,kCADA,GAEA,IAFA;AAGA,KAPA;AAQA,SARA,mBAQA;AAAA;;AACA;AACA;;AACA;AACA;AAAA;AAAA;AACA,SAFA,MAEA,IACA,iBACA,mBADA,IAEA,8BAHA,EAIA;AACA,6CACA;AAAA;AAAA,WADA;AAGA;;AAEA,iCACA,MADA;AAEA;AAFA;AAIA,OAlBA;AAmBA;AA5BA,IAfA;AA6CA,MA7CA,kBA6CA;AACA;AACA,mBADA;AAEA;AAFA;AAIA,GAlDA;AAmDA,SAnDA,qBAmDA;AACA;AACA,GArDA;AAsDA;AACA,QADA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;;AAGA;AACA;AACA;;AALA,sBAOA,+BAPA;AAAA;AAAA;AAAA;;AAAA;AAAA,uBAQA,mBARA;;AAAA;AAAA,sBAWA,kCAXA;AAAA;AAAA;AAAA;;AAAA;AAAA,uBAYA,iBAZA;;AAAA;AAAA;AAAA;;AAAA;AAAA;AAAA;AAeA;AACA,4BADA;AAEA,iCAFA;AAGA,gCAHA;AAIA;AAJA;;AAfA;AAAA;AAsBA;AAtBA;;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;;AAAA;AAAA;AAAA;AAAA;AAyBA,gBAzBA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,uBA2BA,kDA3BA;;AAAA;AAAA;;AAAA;AAAA;AAAA;;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;;AAAA;AAAA;AAAA;AAAA;AA8BA,cA9BA;AAAA;AAAA;AAAA;AAAA;;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,uBAkCA,qBACA,uBADA,EAEA,eAFA,CAlCA;;AAAA;AAAA;AAiCA,uBAjCA,QAiCA,IAjCA,CAiCA,OAjCA;AAuCA;AAvCA;AAAA;;AAAA;AAAA;AAAA;;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;;AAAA;AAAA;AAAA;AAAA;AA0CA,aA1CA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AA0CA,sBA1CA,SA0CA,MA1CA,EA0CA,EA1CA,SA0CA,EA1CA,EA0CA,UA1CA,SA0CA,UA1CA;AAAA;;AAAA,qBA4CA,MA5CA;AAAA;AAAA;AAAA;;AAAA;AAAA,uBA6CA;AACA,8BADA;AAEA;AAFA,kBA7CA;;AAAA;AAAA;AAAA;;AAAA;AAAA;AAAA,uBAiDA;AACA;AADA,kBAjDA;;AAAA;AAAA;AAAA,uBAoDA,mBApDA;;AAAA;AAAA;AAAA;;AAAA;AAAA;AAAA;AAAA;AAAA,uBAsDA;AACA,4BADA;AAEA,iCAFA;AAGA,gCAHA;AAIA;AAJA,kBAtDA;;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;;AAAA;AAAA;AAAA;AAAA;AA8DA,wBA9DA;AAAA;AAAA;AAAA,+FA8DA,KA9DA;AAAA;;AAAA;AAAA;AAAA;AAAA;AAAA;;AAAA,sBAgEA,kBAhEA;AAAA;AAAA;AAAA;;AAAA;;AAAA;AAAA;AAAA,uBAkEA,gFAlEA;;AAAA;AAkEA,wBAlEA;AAAA;AAAA,uBAqEA;AACA;AADA,kBArEA;;AAAA;AAAA;AAAA,mCAoEA,IApEA;AAoEA,sBApEA,cAoEA,MApEA;AAoEA,uBApEA,cAoEA,OApEA;AAAA,kDAyEA,gCAzEA;;AAAA;AAAA;AAAA;;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;;AAAA;AAAA;AAAA;AAAA;AA4EA,yBA5EA;AAAA;AAAA;AAAA,+FA4EA,gBA5EA,EA4EA,KA5EA;AAAA;;AAAA;;AAAA;AAAA;AAAA;AAAA;AAAA;;AAAA,qBA8EA,gBA9EA;AAAA;AAAA;AAAA;;AAAA;AAAA;AAAA;AAAA;;AAAA;AAAA;AAAA;AAAA;AA+EA,qCA/EA,GA+EA;AACA;AACA,2BAjFA;;AAkFA;AACA,kCACA,8BACA,iBADA,aAEA,uBAFA;AAFA;;AAMA,qCAxFA,GAwFA,EAxFA;AAAA;AAAA;AAAA,gHA0FA,CA1FA;AAAA;;AAAA;AAAA;AAAA;AAAA;AAAA,0DA2FA,mBA3FA,EA2FA,QA3FA,uBA2FA,QA3FA,EA2FA,GA3FA,uBA2FA,GA3FA;AA4FA,wCA5FA,GA4FA,QA5FA;AAAA;AAAA,2CA8FA,uBACA,+BADA,EAEA;AACA,8CADA;AAEA,gDAFA;AAGA,0EAHA;AAIA;AACA,2EACA,WACA,gDADA,CADA,EADA,CAOA;;AACA,iDACA,mDADA;;AAEA;AACA,yDACA,8BACA,2CADA,aAEA,uBAFA,MADA;AAIA;AACA;AApBA,qCAFA,CA9FA;;AAAA;AAAA;AA8FA,0CA9FA,SA8FA,MA9FA;AAwHA,wDACA;AACA,wDADA;AAEA;AAFA;;AAzHA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AA0FA,2BA1FA,GA0FA,CA1FA;;AAAA;AAAA,gCA0FA,2BA1FA;AAAA;AAAA;AAAA;;AAAA,+DA0FA,CA1FA;;AAAA;AA0FA,6BA1FA;AAAA;AAAA;;AAAA;AAAA;AAAA,+BA+HA;AA/HA;;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;AAAA;AAAA;;AAAA;;AAAA;AAAA;AAAA;;AAAA;AAAA;AAAA;;AAAA;AAAA;AAmIA;AACA;AApIA;;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;;AAAA;AAAA;AAAA;AAAA;AAuIA,eAvIA;AAAA;AAAA;AAAA;AAAA;;AAAA;AAAA;AAAA;AAAA;AAuIA,wBAvIA,SAuIA,QAvIA,EAuIA,KAvIA,SAuIA,KAvIA;AAAA;AAAA;AAAA,uBA0IA,gCA1IA;;AAAA;AA0IA,gCA1IA;AAAA;AAAA,uBA4IA,mDA5IA;;AAAA;AAAA;;AAAA;AAAA;AAAA;AAAA;;AAAA,+BA4IA,EA5IA;;AAAA;AA2IA,2BA3IA;;AAAA,sBA8IA,kCA9IA;AAAA;AAAA;AAAA;;AA+IA,uBA/IA,GA+IA;AACA,oCADA;AAEA,6CAFA;AAGA;AAHA,iBA/IA;AAAA;AAAA,uBAoJA,uDApJA;;AAAA;AAAA;AAAA,uBAqJA,iBArJA;;AAAA;AAAA;AAAA;;AAAA;AAuJA,wBAvJA,GAuJA;AAAA,2CACA,IADA;AAEA,oDAFA;AAGA;AAHA;AAAA,kBAvJA;AA6JA,sBA7JA,GA6JA,wCACA,kBADA,4BACA,QADA,wBAEA,QAFA,CA7JA;AAiKA;AACA;AADA;;AAjKA;AAAA;AAAA;;AAAA;AAAA;AAAA;AAsKA;AACA,4BADA;AAEA,iCAFA;AAGA,gCAHA;AAIA;AAJA;;AAtKA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;;AAAA;AAAA;AAAA;AAAA;AA8KA,cA9KA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AA8KA,kBA9KA,SA8KA,IA9KA,CA8KA,EA9KA,EA8KA,KA9KA,SA8KA,KA9KA;AAAA;;AAAA,oBAgLA,eAhLA;AAAA;AAAA;AAAA;;AAiLA,uBAjLA,GAiLA;AACA;AAAA;AAAA;AADA,iBAjLA;AAoLA;AApLA;;AAAA;AAAA;AAAA,uBAwLA,iDAxLA;;AAAA;AAAA;AAAA,uBAyLA,iBAzLA;;AAAA;AA2LA;AACA,4BADA;AAEA,kCAFA;AAGA,uCAHA;AAIA;AAJA;AA3LA;AAAA;;AAAA;AAAA;AAAA;AAkMA;AACA,4BADA;AAEA,iCAFA;AAGA,gCAHA;AAIA;AAJA;;AAlMA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;;AAAA;AAAA;AAAA;AAAA;AAAA;AAtDA,G;;;;;;;;;;;;AClBA;AAAA;AAAA;AAAA,IAAIA,SAAS,SAASA,MAAT,GAAkB;AAC7B,MAAIC,MAAM,IAAV;AAAA,MACEC,KAAKD,IAAIE,KAAJ,CAAUD,EADjB;;AAEA,SAAOA,GACL,KADK,EAEL,CACEA,GAAG,SAAH,EAAc;AACZE,WAAO;AACLC,iBAAWJ,IAAIK,KADV;AAELC,0BAAoB,IAFf;AAGLC,oBAAcP,IAAIQ,UAHb;AAILC,oBAAcT,IAAIQ;AAJb,KADK;AAOZE,QAAI;AACFC,iBAAWX,IAAIW,SADb;AAEFC,kBAAYZ,IAAIY,UAFd;AAGFC,mBAAab,IAAIa;AAHf;AAPQ,GAAd,CADF,CAFK,EAiBL,CAjBK,CAAP;AAmBD,CAtBD;;AAuBA,IAAIC,kBAAkB,EAAtB;AACAf,OAAOgB,aAAP,GAAuB,IAAvB;;;;;;;;;;;;;ACxBA;AAAA;AAAA;AAAA;AAAuF;AAC3B;AACL;;;AAGvD;AACyG;AACzG,gBAAgB,2GAAU;AAC1B,EAAE,8EAAM;AACR,EAAE,mFAAM;AACR,EAAE,4FAAe;AACjB;AACA;AACA;AACA;;AAEA;;AAEA;AACA,IAAI,KAAU,EAAE,YAiBf;AACD;AACe,gF;;;;;;;;;;;;ACtCf;AAAA;AAAA,wCAAgN,CAAgB,oPAAG,EAAC,C;;;;;;;;;;;;ACApO;AAAA;AAAA;AAAA;AAAA;AAAA","file":"js/chunks/207.js","sourcesContent":["<template>\r\n  <div>\r\n    <Folders\r\n      :dataArray=\"files\"\r\n      :showFileUploadIcon=\"true\"\r\n      :imagePreview=\"isEditMode\"\r\n      :showDownload=\"isEditMode\"\r\n      @addFolder=\"addFolder\"\r\n      @deleteFile=\"deleteFile\"\r\n      @uploadFiles=\"uploadFiles\"\r\n    />\r\n  </div>\r\n</template>\r\n\r\n<script>\r\nimport { mapGetters } from 'vuex';\r\nimport { getApiErrorMsg, getFileExtension } from '@/helpers/helper';\r\n\r\nexport default {\r\n  name: 'FilesTab',\r\n  components: {\r\n    Folders: () => import('@/components/folders/Folders'),\r\n  },\r\n  props: {\r\n    dataObj: {\r\n      type: Object,\r\n      default: () => ({}),\r\n    },\r\n    isEditMode: {\r\n      type: Boolean,\r\n      default: false,\r\n    },\r\n  },\r\n  computed: {\r\n    ...mapGetters('customerV2', ['getFolderList']),\r\n\r\n    customerId() {\r\n      return this.isEditMode && this.dataObj\r\n        ? parseInt(this.dataObj.customer_id)\r\n        : null;\r\n    },\r\n    files() {\r\n      return this.getFolderList.map((folder) => {\r\n        let files = [];\r\n        if (this.isEditMode) {\r\n          files = this.filesList.filter((file) => file.folderId === folder.id);\r\n        } else if (\r\n          this.dataObj &&\r\n          this.dataObj.files &&\r\n          this.dataObj.files.length > 0\r\n        ) {\r\n          files = this.dataObj.files.filter(\r\n            (file) => file.folderId === folder.id\r\n          );\r\n        }\r\n\r\n        return {\r\n          ...folder,\r\n          files,\r\n        };\r\n      });\r\n    },\r\n  },\r\n  data() {\r\n    return {\r\n      filesList: [],\r\n      uploadPercentage: 0,\r\n    };\r\n  },\r\n  created() {\r\n    this.init();\r\n  },\r\n  methods: {\r\n    async init() {\r\n      try {\r\n        if (this.getFolderList.length === 0 || this.isEditMode) {\r\n          this.$vs.loading();\r\n        }\r\n\r\n        if (this.getFolderList.length === 0) {\r\n          await this.fetchFolders();\r\n        }\r\n\r\n        if (this.isEditMode && this.customerId) {\r\n          await this.fetchFiles();\r\n        }\r\n      } catch (error) {\r\n        this.$vs.notify({\r\n          time: 8000,\r\n          color: 'danger',\r\n          title: 'Error',\r\n          text: getApiErrorMsg(error),\r\n        });\r\n      } finally {\r\n        this.$vs.loading.close();\r\n      }\r\n    },\r\n    async fetchFolders() {\r\n      try {\r\n        return await this.$store.dispatch('customerV2/fetchFolderList');\r\n      } catch (error) {}\r\n    },\r\n    async fetchFiles() {\r\n      try {\r\n        const {\r\n          data: { payload },\r\n        } = await this.$store.dispatch(\r\n          'customerV2/fetchFiles',\r\n          this.customerId\r\n        );\r\n\r\n        this.filesList = payload || [];\r\n      } catch (error) {}\r\n    },\r\n    async addFolder({ isEdit, id, folderName }) {\r\n      try {\r\n        isEdit\r\n          ? await this.$store.dispatch('customerV2/updateFolder', {\r\n              folderId: id,\r\n              folderName,\r\n            })\r\n          : await this.$store.dispatch('customerV2/createFolder', {\r\n              folderName,\r\n            });\r\n        await this.fetchFolders();\r\n      } catch (error) {\r\n        await this.$vs.notify({\r\n          time: 8000,\r\n          color: 'danger',\r\n          title: 'Error',\r\n          text: getApiErrorMsg(error),\r\n        });\r\n      }\r\n    },\r\n    async generateS3NameAndURL(files) {\r\n      try {\r\n        if (files.length === 0) return;\r\n\r\n        const allFiles = await getFileExtension(files);\r\n        const {\r\n          data: { result, payload },\r\n        } = await this.$store.dispatch('customerV2/getUploadUrls', {\r\n          files: allFiles,\r\n        });\r\n\r\n        return result && payload ? payload : [];\r\n      } catch (error) {}\r\n    },\r\n    async uploadAttachmentsToS3(s3FileNameAndURL, files) {\r\n      try {\r\n        if (s3FileNameAndURL) {\r\n          const loadingText = (fileNumber, percentage) => {\r\n            return `Uploading file ${fileNumber} of ${s3FileNameAndURL.length} - ${percentage}%`;\r\n          };\r\n          this.$vs.loading({\r\n            text:\r\n              s3FileNameAndURL.length > 1\r\n                ? loadingText(1, 0)\r\n                : `${this.uploadPercentage}%`,\r\n          });\r\n          const attachments = [];\r\n\r\n          for (let i = 0; i < s3FileNameAndURL.length; i++) {\r\n            const { fileName, url } = s3FileNameAndURL[i];\r\n            const file = files[i];\r\n\r\n            const { status } = await this.$store.dispatch(\r\n              'uploadFileToS3ViaPresignedUrl',\r\n              {\r\n                url,\r\n                file,\r\n                extension: fileName.split('.').pop(),\r\n                onUploadProgress: (progressEvent) => {\r\n                  this.uploadPercentage = parseInt(\r\n                    Math.round(\r\n                      (progressEvent.loaded * 100) / progressEvent.total\r\n                    )\r\n                  );\r\n\r\n                  // Get loader text by class name and update the text\r\n                  const h4 =\r\n                    document.getElementsByClassName('title-loading')[0];\r\n                  if (h4) {\r\n                    h4.innerText =\r\n                      s3FileNameAndURL.length > 1\r\n                        ? loadingText(i + 1, this.uploadPercentage)\r\n                        : `${this.uploadPercentage}%`;\r\n                  }\r\n                },\r\n              }\r\n            );\r\n\r\n            if (status === 200)\r\n              attachments.push({\r\n                fileName,\r\n                originalFileName: file.name,\r\n              });\r\n          }\r\n\r\n          return attachments;\r\n        }\r\n      } catch (error) {\r\n      } finally {\r\n        this.$vs.loading.close();\r\n        this.uploadPercentage = 0;\r\n      }\r\n    },\r\n    async uploadFiles({ folderId, files }) {\r\n      try {\r\n        // Process attachments\r\n        const s3FileNameAndURL = await this.generateS3NameAndURL(files);\r\n        const attachments =\r\n          (await this.uploadAttachmentsToS3(s3FileNameAndURL, files)) || [];\r\n\r\n        if (this.isEditMode && this.customerId) {\r\n          const payload = {\r\n            folderId,\r\n            customerId: this.customerId,\r\n            files: attachments,\r\n          };\r\n          await this.$store.dispatch('customerV2/uploadFiles', payload);\r\n          await this.fetchFiles();\r\n        } else {\r\n          const payload = attachments.map((file, index) => ({\r\n            ...file,\r\n            url: s3FileNameAndURL[index].url,\r\n            folderId,\r\n          }));\r\n\r\n          const files = this.dataObj.files\r\n            ? [...this.dataObj.files, ...payload]\r\n            : [...payload];\r\n\r\n          this.$emit('update:Files', {\r\n            files,\r\n          });\r\n        }\r\n      } catch (error) {\r\n        this.$vs.notify({\r\n          time: 8000,\r\n          color: 'danger',\r\n          title: 'Error',\r\n          text: getApiErrorMsg(error),\r\n        });\r\n      }\r\n    },\r\n    async deleteFile({ file: { id }, index }) {\r\n      try {\r\n        if (!this.isEditMode) {\r\n          const payload = {\r\n            files: this.dataObj.files.filter((_, i) => i !== index),\r\n          };\r\n          this.$emit('update:Files', payload);\r\n          return;\r\n        }\r\n\r\n        await this.$store.dispatch('customerV2/deleteFile', id);\r\n        await this.fetchFiles();\r\n\r\n        this.$vs.notify({\r\n          time: 2000,\r\n          color: 'success',\r\n          title: 'File Deleted',\r\n          text: 'File deleted successfully',\r\n        });\r\n      } catch (error) {\r\n        this.$vs.notify({\r\n          time: 8000,\r\n          color: 'danger',\r\n          title: 'Error',\r\n          text: getApiErrorMsg(error),\r\n        });\r\n      }\r\n    },\r\n  },\r\n};\r\n</script>\r\n","var render = function render() {\n  var _vm = this,\n    _c = _vm._self._c\n  return _c(\n    \"div\",\n    [\n      _c(\"Folders\", {\n        attrs: {\n          dataArray: _vm.files,\n          showFileUploadIcon: true,\n          imagePreview: _vm.isEditMode,\n          showDownload: _vm.isEditMode,\n        },\n        on: {\n          addFolder: _vm.addFolder,\n          deleteFile: _vm.deleteFile,\n          uploadFiles: _vm.uploadFiles,\n        },\n      }),\n    ],\n    1\n  )\n}\nvar staticRenderFns = []\nrender._withStripped = true\n\nexport { render, staticRenderFns }","import { render, staticRenderFns } from \"./FilesTab.vue?vue&type=template&id=5c7378f8&\"\nimport script from \"./FilesTab.vue?vue&type=script&lang=js&\"\nexport * from \"./FilesTab.vue?vue&type=script&lang=js&\"\n\n\n/* normalize component */\nimport normalizer from \"!../../../../../../../node_modules/vue-loader/lib/runtime/componentNormalizer.js\"\nvar component = normalizer(\n  script,\n  render,\n  staticRenderFns,\n  false,\n  null,\n  null,\n  null\n  \n)\n\n/* hot reload */\nif (module.hot) {\n  var api = require(\"D:\\\\laragon\\\\www\\\\ezpapel\\\\panel\\\\node_modules\\\\vue-hot-reload-api\\\\dist\\\\index.js\")\n  api.install(require('vue'))\n  if (api.compatible) {\n    module.hot.accept()\n    if (!api.isRecorded('5c7378f8')) {\n      api.createRecord('5c7378f8', component.options)\n    } else {\n      api.reload('5c7378f8', component.options)\n    }\n    module.hot.accept(\"./FilesTab.vue?vue&type=template&id=5c7378f8&\", function () {\n      api.rerender('5c7378f8', {\n        render: render,\n        staticRenderFns: staticRenderFns\n      })\n    })\n  }\n}\ncomponent.options.__file = \"resources/js/src/views/pages/carriers/components/FilesTab.vue\"\nexport default component.exports","import mod from \"-!../../../../../../../node_modules/babel-loader/lib/index.js??ref--4-0!../../../../../../../node_modules/vue-loader/lib/index.js??vue-loader-options!./FilesTab.vue?vue&type=script&lang=js&\"; export default mod; export * from \"-!../../../../../../../node_modules/babel-loader/lib/index.js??ref--4-0!../../../../../../../node_modules/vue-loader/lib/index.js??vue-loader-options!./FilesTab.vue?vue&type=script&lang=js&\"","export * from \"-!../../../../../../../node_modules/babel-loader/lib/index.js??ref--4-0!../../../../../../../node_modules/vue-loader/lib/loaders/templateLoader.js??ref--6!../../../../../../../node_modules/vue-loader/lib/index.js??vue-loader-options!./FilesTab.vue?vue&type=template&id=5c7378f8&\""],"sourceRoot":""}